webpackJsonp([27],{"4vVj":function(e,t,a){var n=a("iMa+");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a("rjj0")("8b92963e",n,!0,{})},"5zde":function(e,t,a){a("zQR9"),a("qyJz"),e.exports=a("FeBl").Array.from},ExnV:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("c/Tr"),r=a.n(n),i=a("Xxa5"),s=a.n(i),l=a("exGp"),o=a.n(l),c=a("Dd8w"),u=a.n(c),d=a("yTUl"),f=a("NYxO"),p=a("jt1B"),h=a("gyMJ"),m={name:"ScrapMaterialManager",data:function(){return{list:[],tableList:[],loading:!1,treeLoading:!1,btnLoading:!1,filterText:"",checkedKeys:[],multipleSelection:[]}},watch:{filterText:function(e){this.$refs.tree.filter(e)},tableList:{handler:function(e,t){_.isEqual(e,this.referData)?this.setLeaveRemind(!1):this.setLeaveRemind(!0)},deep:!0}},methods:u()({},Object(f.b)(["setLeaveRemind"]),{asyncTableList:function(){var e=this,t=[];Object(p.b)(this.list,function(a){-1!==e.checkedKeys.findIndex(function(e){return e===a.id})&&t.push(a)}),this.tableList=t},checkChangeHandle:function(){this.getCheckedKeys(),this.asyncTableList()},getCheckedKeys:function(){this.checkedKeys=this.$refs.tree.getCheckedKeys(!0)},setCheckedKeys:function(){this.$refs.tree.setCheckedKeys(this.checkedKeys)},filterNode:function(e,t){return!e||-1!==t.search_text.indexOf(e)},getMaterialsTree:function(e){var t=this;return o()(s.a.mark(function a(){var n;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,t.treeLoading=!0,a.next=4,Object(h._29)({id:t.$route.params.id});case 4:1==(n=a.sent).data.code&&(Object(p.b)(n.data.tree,function(e){return e.number=1}),t.list=n.data.tree,e&&e()),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),console.error(a.t0);case 11:t.treeLoading=!1;case 12:case"end":return a.stop()}},a,t,[[0,8]])}))()},getEditedMaterial:function(){var e=this;return o()(s.a.mark(function t(){var a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,Object(h.E)({id:e.$route.params.id});case 4:1==(a=t.sent).data.code&&(e.tableList=a.data.list,Object(p.b)(e.list,function(t){var a=e.tableList.find(function(e){return e.id===t.id});if(void 0!==a)for(var n in a)t[n]=a[n];a=null}),e.referData=_.cloneDeep(e.tableList),e.checkedKeys=e.tableList.map(function(e){return e.id}),e.setCheckedKeys()),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),console.error(t.t0);case 11:e.loading=!1;case 12:case"end":return t.stop()}},t,e,[[1,8]])}))()},handleSelectionChange:function(e){this.multipleSelection=e},removeItemHandle:function(e){var t=this;if(!Array.isArray(e)&&0==(e=this.multipleSelection.map(function(e){return e.id})).length)return this.$message.warning("请勾选原材料名称！");for(var a=function(a){-1!==e.findIndex(function(e){return e===t.checkedKeys[a]})&&t.checkedKeys.splice(a--,1),n=a},n=0;n<this.checkedKeys.length;n++)a(n);var r=function(a){-1!==e.findIndex(function(e){return e===t.tableList[a].id})&&t.tableList.splice(a--,1),n=a};for(n=0;n<this.tableList.length;n++)r(n);this.setCheckedKeys()},saveOrderHandle:function(){var e=this;return o()(s.a.mark(function t(){var a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.btnLoading=!0,t.next=4,Object(h._59)({list:e.tableList.map(function(e){return{id:e.id,store_scrap_material_id:e.store_scrap_material_id,number:e.number}})});case 4:1==(a=t.sent).data.code?(e.$message.success(a.data.message),e.setLeaveRemind(!1),e.$router.push("/storer_manager/scrap_order_list")):e.$message.error(a.data.message),e.btnLoading=!1,t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),console.error(t.t0);case 12:case"end":return t.stop()}},t,e,[[0,9]])}))()},keyUpHandle:function(e){if(e.stopPropagation(),13===e.keyCode&&-1!==e.target.classList.value.search("el-input__inner")){var t=r()(document.querySelectorAll(".material-table > .el-table__body-wrapper .el-input__inner")),a=t.findIndex(function(t){return t===e.target});if(-1===a)return;t[a=++a%t.length].focus()}return!1}}),created:function(){var e=this;this.getMaterialsTree(function(){e.getEditedMaterial()})},mounted:function(){document.querySelector(".material-table").addEventListener("keyup",this.keyUpHandle,!1)},destroyed:function(){document.querySelector(".material-table").removeEventListener("keyup",this.keyUpHandle)},components:{EditNumber:d.a}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"appManager-wrapper"},[a("section",{staticClass:"material-tree-box"},[a("el-input",{attrs:{placeholder:"输入原材料编号/名称","prefix-icon":"el-icon-search"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],ref:"tree",staticClass:"filter-tree",attrs:{"show-checkbox":"",data:e.list,"node-key":"id","default-expand-all":"","expand-on-click-node":!1,"filter-node-method":e.filterNode},on:{check:e.checkChangeHandle}})],1),e._v(" "),a("div",{staticClass:"order-list-box"},[a("div",{staticClass:"appManager-top"},[a("el-button",{staticClass:"fl",on:{click:function(t){return t.stopPropagation(),e.removeItemHandle(t)}}},[e._v("批量移除")]),e._v(" "),a("ul",{staticClass:"fr"},[a("el-button",{staticClass:"fl",attrs:{type:"primary",loading:e.btnLoading},on:{click:function(t){return t.stopPropagation(),e.saveOrderHandle(t)}}},[e._v("保存")])],1)],1),e._v(" "),a("div",{staticClass:"appManager-list fixedTable-list"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"material-table",attrs:{data:e.tableList,border:""},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"原材料名称","min-width":"250"}}),e._v(" "),a("el-table-column",{attrs:{prop:"code",label:"原材料编码"}}),e._v(" "),a("el-table-column",{attrs:{prop:"unit_text",label:"单位"}}),e._v(" "),a("el-table-column",{attrs:{prop:"stock",label:"库存数量"}}),e._v(" "),a("el-table-column",{attrs:{label:"废弃数量",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("EditNumber",{attrs:{maxVal:t.row.stock,stepVal:1},model:{value:t.row.number,callback:function(a){e.$set(t.row,"number",e._n(a))},expression:"scope.row.number"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"100",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){a.stopPropagation(),e.removeItemHandle([t.row.id])}}},[a("i",{staticClass:"el-icon-delete"}),e._v(" 移除\r\n                        ")])]}}])})],1)],1)])])},staticRenderFns:[]};var b=a("VU/8")(m,v,!1,function(e){a("4vVj")},null,null);t.default=b.exports},QlLH:function(e,t,a){var n=a("tvvF");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a("rjj0")("6ea2d616",n,!0,{})},"c/Tr":function(e,t,a){e.exports={default:a("5zde"),__esModule:!0}},fBQ2:function(e,t,a){"use strict";var n=a("evD5"),r=a("X8DO");e.exports=function(e,t,a){t in e?n.f(e,t,r(0,a)):e[t]=a}},"iMa+":function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,".order-list-box{margin-left:360px}",""])},qyJz:function(e,t,a){"use strict";var n=a("+ZMJ"),r=a("kM2E"),i=a("sB3e"),s=a("msXi"),l=a("Mhyx"),o=a("QRG4"),c=a("fBQ2"),u=a("3fs2");r(r.S+r.F*!a("dY0y")(function(e){Array.from(e)}),"Array",{from:function(e){var t,a,r,d,f=i(e),p="function"==typeof this?this:Array,h=arguments.length,m=h>1?arguments[1]:void 0,v=void 0!==m,b=0,g=u(f);if(v&&(m=n(m,h>2?arguments[2]:void 0,2)),void 0==g||p==Array&&l(g))for(a=new p(t=o(f.length));t>b;b++)c(a,b,v?m(f[b],b):f[b]);else for(d=g.call(f),a=new p;!(r=d.next()).done;b++)c(a,b,v?s(d,m,[r.value,b],!0):r.value);return a.length=b,a}})},tvvF:function(e,t,a){(e.exports=a("FZ+f")(!1)).push([e.i,".input-number-wrapper{display:inline-block;max-width:120px}.input-number-wrapper .el-input-number{width:100%}",""])},yTUl:function(e,t,a){"use strict";var n={name:"EditNumber",props:{value:{type:Number,default:1},ctrlPos:{type:String,default:""},minVal:{type:Number,default:0},maxVal:{type:Number,default:999999},stepVal:{type:Number,default:1},disabled:{type:Boolean,default:!1}},data:function(){return{dataVal:this.value}},computed:{promptMsg:function(){return this.value<0?"请输入数字":this.formatNumber(this.value)}},methods:{formatNumber:function(e){for(var t=(e+="").split("."),a="-"===t[0].charAt(0)?"-":"",n=a?t[0].slice(1):t[0],r="";n.length>3;)r=","+n.slice(-3)+r,n=n.slice(0,n.length-3);return n&&(r=n+r),""+a+r+(t[1]?"."+t[1]:"")},handleInput:function(e,t){var a=this;!isNaN(t)&&/^(0|[1-9][0-9]*)(\.[0-9]*)?$/.test(t)||""===t?(t>this.maxVal&&(t=Number(this.maxVal),this.$nextTick(function(){return e.target.value=t})),this.dataVal=Number(t),this.$emit("change",this.dataVal),this.$emit("input",this.dataVal)):this.$nextTick(function(){return e.target.value=a.dataVal})},handleChange:function(e){this.dataVal=Number(e),this.$emit("change",this.dataVal),this.$emit("input",this.dataVal)}}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-tooltip",{attrs:{content:e.promptMsg,placement:"top"}},[a("div",{staticClass:"input-number-wrapper"},[a("el-input-number",{attrs:{size:"mini",value:e.value,min:e.minVal,max:e.maxVal,step:e.stepVal,"controls-position":e.ctrlPos,disabled:e.disabled},on:{change:e.handleChange},nativeOn:{input:function(t){e.handleInput(t,t.target.value)},click:function(e){e.stopPropagation()}}})],1)])},staticRenderFns:[]};var i=a("VU/8")(n,r,!1,function(e){a("QlLH")},null,null);t.a=i.exports}});
//# sourceMappingURL=27.ec5e4594d6af9766353f.js.map